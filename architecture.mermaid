flowchart TD
    subgraph "ğŸš€ External Load Generator"
        LG["Fab Proxy<br/>ğŸ“Š Continuous Load Generation"]
    end

    subgraph "ğŸ—ï¸ Fabrik Microservices Platform"
        FE["Frontend Service<br/>ğŸ”¥ HTTP 500s (15%)<br/>â±ï¸ Slow Responses<br/>ğŸ“Š Dashboard Queries"]
        OS["Orders Service<br/>ğŸ”¥ DB Timeouts (30%)<br/>â±ï¸ 5s Query Delays<br/>ğŸ“¦ Order Processing"]
        FS["Fulfillment Service<br/>ğŸ”¥ DB Timeouts (30%)<br/>â±ï¸ Query Failures<br/>ğŸ›¡ï¸ Fraud Detection"]
        IS["Inventory Service<br/>ğŸ”¥ DB Timeouts (25%)<br/>â™»ï¸ Auto-Replenishment<br/>ğŸ“¦ Stock Management"]
        SR["Shipping Receiver<br/>ğŸ”¥ Message Failures (20%)<br/>â±ï¸ Connection Timeouts<br/>ğŸ“¨ Kafka Consumer"]
        SP["Shipping Processor<br/>ğŸ”¥ gRPC Failures (20%)<br/>ğŸ”¥ DB Timeouts<br/>ğŸšš Shipment Creation"]

        DB[("ğŸ¯ PostgreSQL Database<br/>ğŸ’¥ Primary Failure Target<br/>ğŸ”— Connection Pool<br/>ğŸ“Š Query Performance")]
        K["ğŸ“¨ Kafka Broker<br/>âš¡ Message Queue<br/>ğŸ“ˆ Event Streaming<br/>ğŸ”„ Async Processing"]
    end

    subgraph "ğŸ”¥ Chaos Engineering System"
        direction TB
        CHAOS["âš¡ ArgoCD Simulator<br/>ğŸ¯ Random 0-2hr Intervals<br/>ğŸ’¥ Correlated Failures<br/>ğŸ“Š SDLC Events"]

        subgraph "ğŸ’¥ Failure Types"
            F1["ğŸš¨ HTTP 500 Errors"]
            F2["â±ï¸ Database Timeouts"]
            F3["ğŸ“¨ Message Failures"]
            F4["ğŸ”— gRPC Errors"]
            F5["ğŸŒ Response Delays"]
        end
    end

    subgraph "ğŸ“Š Dynatrace Observability"
        direction TB
        DAVIS["ğŸ¤– Davis AI<br/>ğŸ” Anomaly Detection<br/>ğŸ¯ Root Cause Analysis<br/>ğŸ“ˆ Impact Assessment"]

        subgraph "ğŸ“ˆ Monitoring Targets"
            M1["ğŸ“Š Response Times"]
            M2["ğŸš¨ Error Rates"]
            M3["ğŸ’¾ Database Performance"]
            M4["ğŸ“¨ Message Processing"]
            M5["ğŸ”— Service Dependencies"]
        end
    end

    %% Load Generation Flow
    LG -- "ğŸš€ HTTP POST /order<br/>Continuous Traffic" --> FE

    %% Frontend Flow - HTTP & Database
    FE -- "ğŸ“Š JDBC Order History<br/>ğŸ’¥ 15% Failure Rate<br/>â±ï¸ 3s Timeout Delays" --> DB
    FE -- "ğŸ”— gRPC PlaceOrder<br/>ğŸ’¥ HTTP 500 Injection<br/>â±ï¸ 2s Response Delays" --> OS

    %% Orders Flow - Core Transaction
    OS -- "ğŸ’¾ JDBC Insert Order<br/>ğŸ’¥ 30% Failure Rate<br/>â±ï¸ 5s Query Delays<br/>ğŸ”¥ Connection Pool Stress" --> DB
    OS -- "ğŸ“¤ Publish 'orders' Topic<br/>ğŸ’¥ Transaction Chain Start<br/>ğŸ”„ Async Processing Trigger" --> K

    %% Fulfillment Flow - Async Processing
    K -- "ğŸ“¥ Consume 'orders' Messages<br/>ğŸ’¥ 30% Processing Failures<br/>ğŸ›¡ï¸ Fraud Check Pipeline" --> FS
    FS -- "ğŸ“ JDBC Update Order Status<br/>ğŸ’¥ Query Timeout Exceptions<br/>ğŸ›¡ï¸ Fraud Detection Logic" --> DB

    %% Inventory Flow - Stock Management
    K -- "ğŸ“¥ Consume 'orders' Messages<br/>ğŸ’¥ 25% Processing Failures<br/>ğŸ“¦ Stock Reservation" --> IS
    IS -- "ğŸ“¦ JDBC Stock Lookup/Update<br/>ğŸ’¥ Slow Query Simulation<br/>â™»ï¸ Auto-Replenish @ Stockâ‰¤5" --> DB
    IS -- "ğŸ“¤ Publish 'inventory-reserved'<br/>ğŸ”„ Trigger Shipping Pipeline<br/>âœ… Stock Confirmed" --> K

    %% Shipping Flow - Async + Sync Hybrid
    K -- "ğŸ“¥ Consume 'inventory-reserved'<br/>ğŸ’¥ 20% Message Failures<br/>ğŸšš Shipping Initiation" --> SR
    SR -- "ğŸ”— gRPC ShipOrder Call<br/>ğŸ’¥ Connection Timeouts<br/>â±ï¸ 3s Delay Injection<br/>ğŸšš Shipment Request" --> SP
    SP -- "ğŸ’¾ JDBC Insert Shipment<br/>ğŸ’¥ 20% DB Failures<br/>ğŸšš Tracking Number Gen" --> DB

    %% Chaos Engineering Connections
    CHAOS -.->|"ğŸ’¥ Inject Failures"| OS
    CHAOS -.->|"ğŸ’¥ Inject Failures"| FS
    CHAOS -.->|"ğŸ’¥ Inject Failures"| IS
    CHAOS -.->|"ğŸ’¥ Inject Failures"| SR
    CHAOS -.->|"ğŸ’¥ Inject Failures"| SP
    CHAOS -.->|"ğŸ’¥ Inject Failures"| FE

    %% Observability Connections
    FE -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    OS -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    FS -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    IS -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    SR -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    SP -.->|"ğŸ“Š Metrics & Traces"| DAVIS
    DB -.->|"ğŸ“Š Database Metrics"| DAVIS
    K -.->|"ğŸ“Š Message Metrics"| DAVIS

    %% Styling
    classDef service fill:#e1f5fe,stroke:#01579b,stroke-width:3px;
    classDef chaos fill:#ffebee,stroke:#d32f2f,stroke-width:3px;
    classDef observability fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px;
    classDef db fill:#f3e5f5,stroke:#4a148c,stroke-width:3px;
    classDef queue fill:#fff3e0,stroke:#e65100,stroke-width:3px;
    classDef loadgen fill:#fce4ec,stroke:#880e4f,stroke-width:3px;
    classDef failtype fill:#fff8e1,stroke:#ff8f00,stroke-width:2px;
    classDef montype fill:#f1f8e9,stroke:#558b2f,stroke-width:2px;

    class FE,OS,FS,IS,SR,SP service;
    class CHAOS chaos;
    class DAVIS observability;
    class DB db;
    class K queue;
    class LG loadgen;
    class F1,F2,F3,F4,F5 failtype;
    class M1,M2,M3,M4,M5 montype;
